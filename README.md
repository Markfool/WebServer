# 功能

注册，登录，请求图片视频

# 大的模块

IO处理单元，逻辑处理单元，网络存储单元（mysql+log）

一个异步，多个同步，（日志系统的同步线程）

# 系统模块总览

1. MySQL连接池子（单例）：创建连接池，以备使用。静态资源

2. 线程池：pool->push接口让外部调用（thread_pool* 属于server）（阻塞队列+信号量）

3. 日志线程（单例）：log_write()接口让外部调用（内部有push）（阻塞队列+信号量）

4. 定时器模块(client_data和util_timer是一个互相指向的环状整体，是定时器链表的一个节点属于server。Utils utils是定时器模块，包含链表头尾，添加定时器，调整定时器等，信号处理函数):

   定时器模块维护定时器链表，程序启动时注册信号，信号一到通过管道发送。由epoll监听处理。去查链表处理。处理后重新产生  alarm().

5. http_conn模块。这个模块就是thread_pool的任务模块，通过各种标志来对应不同的任务

6. 然后就是主函数

# 工作流程总览

程序运行流程：

1. 创建SQL连接池实例。初始化：创建mysql连接池

2. 创建Log实例，初始化：创建线程

3. 创建线程池

4. 创建监听socket，初始化定时器模块：在内存注册SIGPIPE,SIGALARM,SIGTERM信号，调用alarm()，创建信号相关的套接字。将信号处理放入epoll监听

5. 监听epoll_wait

   > 1. 读事件
   >
   > 2. 写事件
   >
   > 3. 信号事件
   >
   > 4. 新连接事件：http_conn初始化，定时器节点初始化
   >
   > 5. 信号事件处理后得到具体的信号，第5步就是对信号对应事件的处理（超时，终止）

6. 将监听到的时间封装为http_conn类，作为任务放入线程池的阻塞队列
